{"ast":null,"code":"import _asyncToGenerator from \"/home/ubuntu/SocialVerificationWebsite/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventEmitter } from '@angular/core';\nimport { Group } from '../models/group';\nimport { Interaction } from '../models/interaction';\nimport { Position } from '../models/position';\nimport { MicroInteraction } from '../models/microInteraction';\nimport * as i0 from \"@angular/core\";\nexport class CanvasManagerService {\n  constructor() {\n    this.interaction = new Interaction();\n    this.isAddingGroup = false;\n    this.addingTransition = 0;\n    this.currentMicroType = '';\n    this.updateBtnState = new EventEmitter();\n    this.getUpdatedInteraction = new EventEmitter();\n    this.canvasOffset = new Position(0, 0);\n  }\n\n  addGroup(x, y) {\n    let isInitial = this.interaction.groupIdCounter == 0 ? true : false;\n    let name = 'untitled' + this.interaction.groupIdCounter;\n    let g = new Group(isInitial, this.interaction.groupIdCounter, name, x, y);\n    this.interaction.groupIdCounter++;\n    this.interaction.groups.push(g);\n    this.getUpdatedInteraction.emit(this.interaction);\n    return g;\n  }\n\n  removeGroup(groupId) {\n    this.interaction.removeGroup(groupId);\n\n    if (this.interaction.groups.length == 0) {\n      this.interaction.groupIdCounter = 0;\n    }\n\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n\n  addMicroToGroup(groupId) {\n    const g = this.interaction.getGroup(groupId);\n\n    if (!g) {\n      console.log(\"ERROR: add micro to group failure with groupId: %d\", groupId);\n      return null;\n    }\n\n    let m = new MicroInteraction(g.microIdCounter++, this.currentMicroType);\n    g.micros.push(m);\n    this.getUpdatedInteraction.emit(this.interaction);\n    return m;\n  }\n\n  removeMicro(groupId, microId) {\n    const g = this.interaction.getGroup(groupId);\n\n    if (!g) {\n      console.log(\"ERROR: remove micro failure with groupId: %d\", groupId);\n      return;\n    }\n\n    g.removeMicro(microId);\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n  /* State management for view reflection */\n\n\n  setAddingGroup(val) {\n    this.isAddingGroup = val;\n    this.addingTransition = 0;\n    this.updateBtnState.emit();\n  }\n\n  setAddingTransition(val) {\n    this.addingTransition = val;\n    this.isAddingGroup = false;\n    this.updateBtnState.emit();\n  }\n\n  getGroupById(id) {\n    let g = this.interaction.groups.find(x => x.id === id);\n\n    if (g) {\n      return g;\n    }\n\n    return undefined;\n  }\n\n  updateGroup(group) {\n    let gs = this.interaction.groups.filter(x => x.id != group.id);\n    gs.push(group);\n    this.interaction.groups = gs;\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n\n  loadInteractionFromXMLFile(file) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var reader = new FileReader();\n      reader.readAsText(file);\n      let text = null;\n      let t = yield file.text();\n      _this.interaction = new Interaction(t);\n\n      _this.getUpdatedInteraction.emit(_this.interaction);\n      /*\n      reader.onloadend = function () {\n        text = reader.result;\n        console.log(\"in async?\");\n      }\n           if (text) {\n        this.interaction = new Interaction(text);\n             this.getUpdatedInteraction.emit(this.interaction);\n      }\n      */\n\n    })();\n  }\n\n  loadInteractionFromLocal() {\n    let xmlString = localStorage.getItem('interactionXML');\n    this.interaction = new Interaction(xmlString);\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n  /* Save interaction to XML */\n\n\n  saveInteractionToLocal() {\n    let xmlString = this.interaction.exportModelToXML();\n    localStorage.setItem('interactionXML', xmlString);\n  }\n\n  clearCanvas() {\n    this.interaction = new Interaction(null);\n    this.getUpdatedInteraction.emit(this.interaction);\n    this.saveInteractionToLocal();\n  }\n\n}\n\nCanvasManagerService.ɵfac = function CanvasManagerService_Factory(t) {\n  return new (t || CanvasManagerService)();\n};\n\nCanvasManagerService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CanvasManagerService,\n  factory: CanvasManagerService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["EventEmitter","Group","Interaction","Position","MicroInteraction","CanvasManagerService","constructor","addGroup","x","y","isInitial","interaction","groupIdCounter","name","g","groups","push","getUpdatedInteraction","emit","removeGroup","groupId","length","addMicroToGroup","getGroup","console","log","m","microIdCounter","currentMicroType","micros","removeMicro","microId","setAddingGroup","val","isAddingGroup","addingTransition","updateBtnState","setAddingTransition","getGroupById","id","find","undefined","updateGroup","group","gs","filter","loadInteractionFromXMLFile","file","reader","FileReader","readAsText","text","t","loadInteractionFromLocal","xmlString","localStorage","getItem","saveInteractionToLocal","exportModelToXML","setItem","clearCanvas","factory","providedIn"],"sourceRoot":"","sources":["/home/ubuntu/SocialVerificationWebsite/client/src/app/services/canvas-manager.service.ts"],"sourcesContent":["import { EventEmitter, Injectable, Output } from '@angular/core';\nimport { Group } from '../models/group';\nimport { Interaction } from '../models/interaction';\nimport { Position } from '../models/position';\nimport { MicroInteraction } from '../models/microInteraction';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CanvasManagerService {\n\n  interaction: Interaction = new Interaction();\n\n  isAddingGroup: boolean = false;\n  addingTransition: number = 0;\n  currentMicroType: string = '';\n\n  @Output() updateBtnState: EventEmitter<any> = new EventEmitter();\n  @Output() getUpdatedInteraction: EventEmitter<Interaction> = new EventEmitter<Interaction>();\n\n  canvasOffset: Position = new Position(0, 0);\n\n  constructor() {}\n\n  addGroup(x: number, y: number): Group {\n\n    let isInitial: boolean = this.interaction.groupIdCounter == 0 ? true : false;\n    let name: string = 'untitled' + this.interaction.groupIdCounter;\n\n    let g = new Group(isInitial, this.interaction.groupIdCounter, name, x, y);\n\n    this.interaction.groupIdCounter++;\n\n    this.interaction.groups.push(g);\n\n    this.getUpdatedInteraction.emit(this.interaction);\n\n    return g;\n  }\n\n  removeGroup(groupId: number):void {\n    this.interaction.removeGroup(groupId);\n\n    if (this.interaction.groups.length == 0) {\n      this.interaction.groupIdCounter = 0;\n    }\n\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n\n  addMicroToGroup(groupId: number): MicroInteraction  | null {\n\n    const g: Group | undefined = this.interaction.getGroup(groupId);\n    \n    if (!g) {\n      console.log(\"ERROR: add micro to group failure with groupId: %d\", groupId);\n      return null;\n    }\n\n    let m: MicroInteraction = new MicroInteraction(g.microIdCounter++, this.currentMicroType);\n\n    g.micros.push(m);\n\n    this.getUpdatedInteraction.emit(this.interaction);\n    \n    return m;\n  }\n\n  removeMicro(groupId: number, microId: number):void {\n    const g: Group | undefined = this.interaction.getGroup(groupId);\n    \n    if (!g) {\n      console.log(\"ERROR: remove micro failure with groupId: %d\", groupId);\n      return;\n    }\n\n    g.removeMicro(microId);\n\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n\n  /* State management for view reflection */\n  setAddingGroup(val: boolean) {\n    this.isAddingGroup = val;\n    this.addingTransition = 0;\n\n    this.updateBtnState.emit();\n  }\n\n  setAddingTransition(val: number) {\n    this.addingTransition = val;\n    this.isAddingGroup = false;\n\n    this.updateBtnState.emit();\n  }\n\n  \n  getGroupById(id: number): Group | undefined {\n    let g: Group | undefined = this.interaction.groups.find((x: Group) => x.id === id);\n\n    if (g) {\n      return g;\n    }\n    return undefined;\n  }\n\n  updateGroup(group: Group) {\n    let gs: Group[] = this.interaction.groups.filter((x: Group) => x.id != group.id);\n\n    gs.push(group);\n\n    this.interaction.groups = gs;\n\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n\n  async loadInteractionFromXMLFile(file: File) {\n    var reader = new FileReader();\n    reader.readAsText(file);\n\n    let text: string | ArrayBuffer | null = null;\n\n    let t: string = await file.text();\n\n    this.interaction = new Interaction(t);\n\n    this.getUpdatedInteraction.emit(this.interaction);\n\n    /*\n    reader.onloadend = function () {\n      text = reader.result;\n      console.log(\"in async?\");\n    }\n\n    if (text) {\n      this.interaction = new Interaction(text);\n\n      this.getUpdatedInteraction.emit(this.interaction);\n    }\n    */ \n  }\n\n\n  loadInteractionFromLocal(): void {\n    let xmlString = localStorage.getItem('interactionXML');\n\n    this.interaction = new Interaction(xmlString);\n\n    this.getUpdatedInteraction.emit(this.interaction);\n  }\n\n  /* Save interaction to XML */\n  saveInteractionToLocal() {\n    let xmlString = this.interaction.exportModelToXML();\n\n    localStorage.setItem('interactionXML', xmlString);\n  }\n\n  clearCanvas() {\n    this.interaction = new Interaction(null);\n\n    this.getUpdatedInteraction.emit(this.interaction);\n\n    this.saveInteractionToLocal();\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}